:root{
  --cw-bg:#0b0b0c; --cw-panel:#141417; --cw-border:#2a2a2e;
  --cw-muted:#8b8b93; --cw-text:#e9e9ee; --cw-primary:#6ee7b7;
  --cw-shadow:0 10px 30px rgba(0,0,0,.35);
}
@media (prefers-color-scheme: light){
  :root{ --cw-bg:#f6f7fb; --cw-panel:#fff; --cw-border:#e6e6ef;
    --cw-muted:#6b7280; --cw-text:#0b0b0f; --cw-primary:#14b8a6;
    --cw-shadow:0 10px 30px rgba(2,8,20,.12);
  }
}
*,*::before,*::after{ box-sizing: border-box; }
html,body{ margin:0; width:100%; max-width:100%;
  background:var(--cw-bg); color:var(--cw-text);
  font:15px/1.4 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  overflow-x:hidden;
}

/* --- Launcher --- */
.cw-launcher{
  position:fixed; right:20px; bottom:20px; z-index:9999;
  width:64px; height:64px; border-radius:999px; isolation:isolate;
  border:1px solid rgba(255,255,255,.06);
  background:
    radial-gradient(120% 140% at 30% 20%, rgba(255,255,255,.06), rgba(0,0,0,0) 60%),
    linear-gradient(180deg,#0f1116,#0a0b0f);
  box-shadow:0 12px 24px rgba(0,0,0,.45),
             inset 0 1px 0 rgba(255,255,255,.05),
             inset 0 -1px 0 rgba(0,0,0,.35);
  display:grid; place-items:center; color:#e6e9ee;
  transition:transform .15s ease, box-shadow .2s ease;
}
.cw-launcher:hover{
  transform:translateY(-2px);
  box-shadow:0 16px 32px rgba(0,0,0,.55),
             inset 0 1px 0 rgba(255,255,255,.07),
             inset 0 -1px 0 rgba(0,0,0,.45);
}
.cw-launcher svg{ position:relative; z-index:2; opacity:.9;
  filter:drop-shadow(0 1px 0 rgba(255,255,255,.08));
}
#cw-orb{
  position:absolute; inset:-24px; width:calc(100% + 48px); height:calc(100% + 48px);
  pointer-events:none; z-index:1; filter:blur(2px); opacity:1;
}
/* Halo extra CSS para sumar glow */
.cw-launcher::after{
  content:""; position:absolute; inset:-14px; border-radius:999px; z-index:0;
  background:radial-gradient(circle at 55% 45%, rgba(120,160,255,.35), transparent 60%);
  filter:blur(14px); animation:cw-lpulse 3s ease-in-out infinite;
}
@keyframes cw-lpulse{ 0%,100%{transform:scale(.95);opacity:.35} 50%{transform:scale(1.05);opacity:.75} }

.cw-badge{
  position:absolute; right:-2px; top:-2px; width:18px; height:18px; z-index:3;
  border-radius:999px; background:var(--cw-primary); border:2px solid #0a0b0f;
  box-shadow:0 4px 10px rgba(110,231,183,.45);
}

/* --- Panel --- */
.cw-panel{
  position:fixed; right:20px; bottom:92px; z-index:9998;
  width:360px; max-width:min(420px,calc(100vw - 32px));
  height:540px; max-height:calc(100vh - 140px);
  background:var(--cw-panel); border:1px solid var(--cw-border); border-radius:16px;
  box-shadow:var(--cw-shadow); overflow:hidden;
  transform:translateY(20px) scale(.98); opacity:0; pointer-events:none;
  transition:transform .2s ease, opacity .2s ease;
}
.cw-panel.open{ transform:translateY(0) scale(1); opacity:1; pointer-events:auto; }

.cw-header{
  display:flex; align-items:center; justify-content:space-between;
  padding:12px; border-bottom:1px solid var(--cw-border);
  background:linear-gradient(180deg, rgba(255,255,255,.02), transparent);
}
.cw-title{ display:flex; align-items:baseline; gap:8px; }
.cw-title strong{ font-weight:700; }
.cw-title small{ color:var(--cw-muted); font-size:12px; }
.cw-dot{ width:8px; height:8px; border-radius:999px; background:var(--cw-primary);
  display:inline-block; box-shadow:0 0 0 3px rgba(110,231,183,.15);
}
.cw-actions{ display:flex; gap:4px; }
.cw-iconbtn{ width:28px; height:28px; border-radius:8px; cursor:pointer;
  border:1px solid var(--cw-border); background:transparent; color:var(--cw-text);
}
.cw-body{ display:grid; grid-template-rows:1fr auto auto; height:calc(100% - 52px); }

/* --- Mensajes --- */
.cw-messages{ overflow:auto; padding:10px 12px 0; }
.cw-messages::-webkit-scrollbar{ width:10px; }
.cw-messages::-webkit-scrollbar-thumb{ background:var(--cw-border); border-radius:10px; }

.cw-thread{ display:flex; flex-direction:column; gap:8px; padding:10px 12px 16px; }
.msg{ max-width:80%; padding:8px 12px; border-radius:12px; line-height:1.45; font-size:14px;
  word-break:break-word; overflow-wrap:anywhere; border:1px solid var(--cw-border);
}
.msg.user{ margin-left:auto; background:var(--cw-primary); color:#0b0b0c; }
.msg.bot{ margin-right:auto; background:#15151b; color:var(--cw-text);
  border:1px solid rgba(120,120,160,.25);
  box-shadow:0 0 0 1px rgba(120,120,200,.06) inset, 0 8px 22px rgba(0,0,0,.35);
}

#chips{ display:flex; flex-wrap:wrap; gap:8px; padding:10px 12px; border-top:1px dashed var(--cw-border); }
.chip{ border:1px solid var(--cw-border); background:transparent; color:var(--cw-text);
  border-radius:999px; padding:6px 10px; font-size:13px; cursor:pointer;
}
.chip:hover{ border-color:var(--cw-primary); }

/* --- Input --- */
.cw-footer{ display:grid; grid-template-columns:1fr auto; gap:8px;
  padding:12px; border-top:1px solid var(--cw-border);
}
#msg{ width:100%; resize:none; padding:10px 12px; border-radius:12px;
  border:1px solid var(--cw-border); background:transparent; color:var(--cw-text);
  font:inherit; outline:none; max-height:140px; overflow:auto;
}
#msg:focus{ box-shadow:0 0 0 2px rgba(110,231,183,.25); border-color:var(--cw-primary); }
.cw-send{ padding:0 14px; border-radius:12px; border:1px solid var(--cw-border);
  background:var(--cw-primary); color:#0b0b0c; font-weight:700; cursor:pointer;
}

/* ocultar debug por defecto */
.cw-advanced{ display:none; }

/* Mobile */
@media (max-width:480px){
  .cw-panel{ right:12px; left:12px; width:auto; max-width:calc(100vw - 24px); height:70vh; }
  .cw-advanced .row{ grid-template-columns:1fr; }
  .cw-advanced button,.cw-advanced input{ width:100%; }
}

/* Launcher minimal: esfera oscura */
.cw-launcher{
  position: fixed; right: 20px; bottom: 20px; z-index: 9999;
  width: 72px; height: 72px; border-radius: 999px; isolation: isolate;
  border: 1px solid rgba(255,255,255,.06);
  background: radial-gradient(120% 120% at 45% 35%, #18202f, #0b0c12 70%);
  box-shadow:
    0 14px 28px rgba(0,0,0,.5),
    inset 0 1px 0 rgba(255,255,255,.05),
    inset 0 -1px 0 rgba(0,0,0,.45);
  padding: 0; overflow: visible; /* para que los puntos respiren fuera */
  cursor: pointer; transition: transform .15s ease, box-shadow .2s ease;
}
.cw-launcher:hover{ transform: translateY(-2px); }

/* SIN icono ni halo ::after */
.cw-launcher svg, .cw-launcher::after { display: none !important; }

/* Canvas ocupa y sobresale para que los puntos salgan “fuera” */
#cw-orb{
  position: absolute; inset: -28px;  /* respira fuera del botón */
  width: calc(100% + 56px);
  height: calc(100% + 56px);
  pointer-events: none; z-index: 1;
  filter: blur(0px); /* el glow lo hacemos en JS */
}

/* Badge (si lo usas) */
.cw-badge{
  position: absolute; right: -2px; top: -2px; width: 18px; height: 18px; z-index: 3;
  border-radius: 999px; background: var(--cw-primary); border: 2px solid #0a0b0f;
  box-shadow: 0 4px 10px rgba(110,231,183,.45);
}
.cw-launcher{ overflow: hidden; }  /* recorta lo que se salga */
/* el canvas NO debe llevar blur por CSS */
#cw-orb{
  filter: none;
}
.cw-launcher{ overflow: hidden; } /* recorte circular por si acaso */

/* ====== zIA THEME OVERRIDES (light + dark) ====== */
:where([data-zia]) {
  /* Light (default) */
  --cw-primary: #10b981;             /* verde botón/chips */
  --cw-primary-contrast: #ffffff;

  --cw-bg: #ffffff;                  /* fondo inputs */
  --cw-surface: #f7f8fb;             /* superficies */
  --cw-elev-1: #ffffff;              /* panel/launcher */
  --cw-text: #0f172a;                /* texto principal */
  --cw-muted: #64748b;               /* texto secundario */
  --cw-border: #e5e7eb;              /* bordes suaves */

  --cw-bubble: #f3f4f6;              /* burbuja asistente */
  --cw-bubble-text: #111827;
  --cw-user-bubble: var(--cw-primary);
  --cw-user-text: var(--cw-primary-contrast);
}

/* ====== Minimal Performance Theme (reduce animaciones y sombras) ====== */
:root[data-zia-theme="minimal"] .cw-launcher{
  background: #0f1116 !important;
  box-shadow: none !important;
  border: 1px solid rgba(255,255,255,.08) !important;
  transition: none !important;
}
:root[data-zia-theme="minimal"] #cw-orb{ display:none !important; }
:root[data-zia-theme="minimal"] .cw-launcher::after{ display:none !important; }
:root[data-zia-theme="minimal"] .cw-panel{
  box-shadow: none !important;
  transition: none !important;
}
:root[data-zia-theme="minimal"] .cw-iconbtn,
:root[data-zia-theme="minimal"] .chip,
:root[data-zia-theme="minimal"] #msg,
:root[data-zia-theme="minimal"] .cw-send{ transition: none !important; }

@media (prefers-color-scheme: dark) {
  :where([data-zia]) {
    --cw-bg: #0b0f14;
    --cw-surface: #0f141a;
    --cw-elev-1: #0f141a;
    --cw-text: #e5e7eb;
    --cw-muted: #9ca3af;
    --cw-border: #1f2937;

    --cw-bubble: #1f2937;
    --cw-bubble-text: #e5e7eb;
    --cw-user-bubble: #10b981;
    --cw-user-text: #05251b;
  }
}

/* Panel y estructura */
:where([data-zia]) .cw-panel{
  background: var(--cw-elev-1) !important;
  color: var(--cw-text) !important;
  border: 1px solid var(--cw-border);
  box-shadow: 0 12px 30px rgba(0,0,0,.18);
  color-scheme: light dark;
}
:where([data-zia]) .cw-header{
  background: var(--cw-elev-1) !important;
  border-bottom: 1px solid var(--cw-border) !important;
}
:where([data-zia]) .cw-title small{ color: var(--cw-muted); }

/* Burbujas */
:where([data-zia]) .cw-thread .msg{
  background: var(--cw-bubble) !important;
  color: var(--cw-bubble-text) !important;
}
:where([data-zia]) .cw-thread .msg.me{
  background: var(--cw-user-bubble) !important;
  color: var(--cw-user-text) !important;
}

/* Chips / sugerencias */
:where([data-zia]) #chips{ gap: .5rem; }
:where([data-zia]) .cw-chip{
  background: var(--cw-surface) !important;
  color: var(--cw-text) !important;
  border: 1px solid var(--cw-border) !important;
}
:where([data-zia]) .cw-chip:hover,
:where([data-zia]) .cw-chip[aria-pressed="true"]{
  background: var(--cw-primary) !important;
  color: var(--cw-primary-contrast) !important;
  border-color: var(--cw-primary) !important;
}

/* Input y botón enviar */
:where([data-zia]) textarea#msg{
  background: var(--cw-bg) !important;
  color: var(--cw-text) !important;
  border: 1px solid var(--cw-border) !important;
}
:where([data-zia]) .cw-send{
  background: var(--cw-primary) !important;
  color: var(--cw-primary-contrast) !important;
}

/* Launcher */
:where([data-zia]) .cw-launcher{
  background: var(--cw-elev-1) !important;
  border: 1px solid var(--cw-border) !important;
}

/* Orb (un poco más tenue en claro) */
:where([data-zia]) #cw-orb{ opacity: .85; }
@media (prefers-color-scheme: light){
  :where([data-zia]) #cw-orb{ opacity: .7; }
}
